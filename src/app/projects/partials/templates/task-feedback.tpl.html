<div ng-if="activeTask">
  <div class="pull-left list-group col-md-2 task-status">
    <a ng-repeat="task in submittedTasks" ng-class="{'active' : task == activeTask }" class="list-group-item text-center {{statusClass(task.status)}}" ng-click="setActiveTask(task)">{{task.task_abbr}} <i class="task-icon {{statusData(task).icon}} fa-lg"></i></a>
  </div>
  <div class="col-md-10 pull-right">
    <div class="comments-panel panel panel-default">
      <div class="panel-heading task-status row-fluid">
        <h3 class="panel-title">Comments</h3>
      </div>
      <div class="panel-body" style="max-height: 250px; overflow-y: scroll" >
        <div class="text-center" ng-show="(!activeTask.comments) || activeTask.comments.length == 0" style="margin: 30px">
          <i class="fa fa-2x fa-comments-o"></i><br/>
          No comments have yet been made.
        </div>
        <div class="comment" ng-repeat="comment in activeTask.comments">
          <div class="comment-details col-md-2">
            <span class="comment-by">
              {{comment.comment_by}}
            </span>
            <span class="comment-date">
              {{comment.created_at | date: 'd MMM yyyy'}}
            </span>
          </div>
          <div class="comment-text col-md-10">
            <div class="col-md-11">
              {{comment.comment}}
            </div>
            <div class="col-md-1 delete-comment text-right" ng-click="deleteComment(comment.id)">
              <i class="fa fa-times-circle"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="panel-footer">
        <form class="input-group" ng-submit="addComment()" role="form">
          <textarea ng-keyup="checkCommentTextareaEnter()" ng-model="comment.text" class="form-control" style="height: 45px; resize: none;" placeholder="Make a comment on this submission..."></textarea>
          <span class="input-group-btn">
            <button type="submit" class="btn btn-primary"  style="height: 45px" type="button" ng-disabled="comment.text.trim().length == 0">
              <i class="fa fa-plus fa-2x"></i>
            </button>
          </span>
        </form>
      </div>
    </div>

    <div id="panel" class="panel panel-default">
      <div class="panel-heading task-status row-fluid">
          <h3 class="panel-title">{{activeTask.task_name}}</h3><!--/title-->
          <div class="pull-right">
            <div class="btn-group pdf-nav" ng-hide="shouldHideNav()">
              <button type="button" class="btn btn-default" ng-disabled="shouldDisableLeftNav()" ng-click="prevPage()">
                <span class="glyphicon glyphicon-chevron-left"></span>
              </button>
              <button type="button" class="btn btn-default" ng-disabled="shouldDisableRightNav()" ng-click="nextPage()">
                <span class="glyphicon glyphicon-chevron-right"></span>
              </button>
            </div><!--/page-nav-->

            <div tooltip-placement="right" tooltip="{{activeStatusData().label}}" class="btn-group" dropdown>
              <button style="width: 52px;" class="btn task-status {{statusClass(activeTask.status)}}" ng-click="showAssessTaskModal(activeTask)">
                <i class="{{activeStatusData().icon}} fa-2x"></i>
              </button>
              <button style="height: 42px;"type="button" class="btn task-status {{statusClass(activeTask.status)}} dropdown-toggle">
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" style="padding: 0px;">
                <li if-role="Tutor Convenor Admin" ng-repeat="action in taskEngagementConfig.tutorTriggers" class="text-center">
                  <a style="padding: 15px;" class="{{action.taskClass}}" ng-class="{'active' : activeTask.status == action.status}" ng-click="triggerTransition(action.status)" ng-model="activeTask.status" btn-radio="action.status" uncheckable> 
                    <i class="{{action.iconClass}} fa-2x task-engagement-icon"></i> 
                    <strong>{{action.label}}</strong>
                  </a>
                </li><!--/tutor-statuses-->
                <li ng-repeat="action in taskEngagementConfig.studentTriggers" class="text-center">
                  <a style="padding: 15px;" class="{{action.taskClass}}" ng-class="{'active' : activeTask.status == action.status}" ng-click="triggerTransition(action.status)" ng-model="activeTask.status" btn-radio="action.status" > 
                    <i class="{{action.iconClass}} fa-2x task-engagement-icon"></i> 
                    <strong>{{action.label}}</strong>
                  </a>
                </li><!--/student-statuses-->
              </ul>
            </div>

          </div>
      </div>
      <div class="panel-body">
        <p class="lead text-center" ng-hide="taskStillProcessing() || corruptPdf() || readyToShowPDF()">
          <br/>
          <i class="fa fa-spinner fa-spin fa-2x"></i>
          <br/>
          PDF is rendering...
        </p><!--/pdf-in-process-->
        <p class="lead text-center" ng-show="taskStillProcessing()">
          <br/>
          <i class="fa fa-clock-o fa-2x"></i>
          <br/>
          PDF is being processed. Come back soon.
        </p><!--/pdf-in-process-->
        <p class="lead text-center text-danger" ng-show="corruptPdf()">
          <br/>
          <i class="fa fa-exclamation-triangle fa-2x"></i>
          <br/>
          PDF preview cannot be rendered.
        </p><!--/corrupt-pdf-->
        <a href="{{activeTaskUrl()}}" ng-show="readyToShowPDF()">
          <canvas width="0" height="0" id="pdf"></canvas>
        </a><!--/pdf-->
      </div>
      <div ng-hide="taskStillProcessing()" class="panel-footer" style="height: 60px">
        <div class="pull-left text-muted">
          <strong>Note:</strong> {{activeTask.status != 'ready_to_mark' ? "Annotated comments are viewable once PDF is downloaded" : "Comments will be available once your tutor has assessed your submission"}}
        </div>
        <div class="pull-right btn-group">
          <button class="btn btn-info" ng-click="recreatePDF()" tooltip-popup-delay='500' tooltip-placement="top" tooltip="Recreate the task's PDF">
            <span class="fa fa-recycle"></span>
          </button>
          <a href="{{activeTaskUrl()}}" class="btn btn-success">
            <span class="glyphicon glyphicon-cloud-download"></span>
          </a>
        </div>
      </div><!--/panel-footer-->
    </div>
  </div>

</div>