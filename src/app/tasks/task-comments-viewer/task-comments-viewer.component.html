<div
  style="height: 100%"
  *ngIf="task"
  class="comments-panel"
  ngf-drop="uploadFiles($files)"
  ngf-drag-over-class="'dragover'"
  ngf-multiple="true"
  ngf-pattern="'image/*,application/pdf'"
  fxLayout="column"
>
  <div fxFlex="50px" class="comments-header">
    <div class="mat-h2 header-text">
      Comments on this task
    </div>
  </div>
  <div fxFlex class="comments-body">
    <div>
      <!-- TODO:  | orderBy:'+created_at' -->
      <span>
        <div
          id="comment-{{ comment.id }}"
          *ngFor="let comment of task.comments"
          ng-mouseover="hover=true"
          ng-mouseleave="hover=false"
          class="anchor"
        >
          <!-- comment.created_at | humanizedDate -->
          <p id="commentTimestamp" *ngIf="comment.should_show_timestamp">
            {{ comment.author.name }} {{ comment.created_at }}
          </p>
          <div
            class="comment"
            [ngClass]="{
              'comment-by-other-user': !comment.author_is_me,
              'new-comment': comment.is_new
            }"
          >
            <user-icon
              *ngIf="
                comment.should_show_avatar && shouldShowAuthorIcon(comment.type)
              "
              [size]="20"
              [user]="comment.author"
              [ngClass]="{ 'hidden-xs hidden-sm': comment.author_is_me }"
            >
            </user-icon>

            <div class="comment-container" [ngSwitch]="comment.type">
              <div *ngSwitchCase="status" class="comment-status">
                <hr class="hr-text" data-content="{{ comment.comment }}" />
              </div>

              <div class="bubble" [ngClass]="commentClasses(comment)">
                <a
                  (click)="scrollToComment(comment.original_comment.id)"
                  class="original-comment"
                  *ngIf="!!comment.reply_to_id"
                >
                  <p class="reply-text">
                    <i class="fa fa-reply"></i>
                    {{
                      comment.original_comment
                        ? comment.original_comment.comment
                        : "comment removed"
                    }}
                  </p>
                </a>
                <div *ngSwitchCase="'extension'" class="comment-extension">
                  <extension-comment [task]="task" [comment]="comment">
                  </extension-comment>
                </div>

                <div *ngSwitchCase="'text'" class="comment-text">
                  <div
                    class="markdown-to-html"
                    [innerHTML]="comment.comment | marked"
                  ></div>
                </div>

                <div *ngSwitchCase="'audio'" class="comment-audio">
                  <audio-player></audio-player>
                </div>

                <div *ngSwitchCase="'discussion'" class="comment-discussion">
                  <intelligent-discussion-player
                    [task]="task"
                    [discussion]="comment"
                  ></intelligent-discussion-player>
                </div>

                <div *ngSwitchCase="'image'" class="comment-image">
                  <a (click)="openCommentsModal(comment)">
                    <img
                      [src]="getCommentAttachment(comment)"
                      width="100%"
                      height="100%"
                    />
                  </a>
                </div>

                <div *ngSwitchCase="'pdf'" class="comment-pdf">
                  <a (click)="openCommentsModal(comment)">
                    <p><i class="fa fa-file-pdf-o"></i> view pdf</p>
                  </a>
                </div>
              </div>
              <div
                *ngIf="isBubbleComment(comment.type)"
                class="comment-overflow"
              >
                <comment-bubble-action
                  ng-show="hover"
                  [task]="task"
                  [comment]="comment"
                ></comment-bubble-action>
              </div>
            </div>
          </div>
        </div>
      </span>

      <div
        *ngIf="lastComment.recipient"
        class="read-receipt"
        [hidden]="!lastComment.author_is_me && !lastComment.recipient_read_time"
      >
        <!-- lastComment.recipient_read_time | humanizedDate -->
        Read {{ lastComment.recipient_read_time }} by
        {{ lastComment.recipient.name }}
      </div>
    </div>
  </div>
  <!--/comment-list-->
  <div fxFlex="50px" class="comments-footer" id="commentComposerFoter">
    <task-comment-composer [task]="task"></task-comment-composer>
  </div>
</div>
